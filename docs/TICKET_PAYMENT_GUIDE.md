# ๐ซ ุฑุงูููุง ุณุณุชู ุชฺฉุช ู ูพุฑุฏุงุฎุช ุฏุณุช

## ๐ ููุง ฺฉู

ุงู ุณุณุชู ุงูฺฉุงู ุฎุฑุฏ ูพููโูุง ุจุง ูพุฑุฏุงุฎุช ุฏุณุช (ฺฉุงุฑุช ุจู ฺฉุงุฑุช ุง ูุงุฑุฒ ุดุจุง) ุฑุง ูุฑุงูู ูโฺฉูุฏ. ูุฑุขูุฏ ุจู ุตูุฑุช ุฒุฑ ุงุณุช:

```
ฺฉุงูุฏุฏ โ ุฎุฑุฏ ูพูู โ ุขูพููุฏ ูุด โ ุณุงุฎุช ุชฺฉุช
   โ
ุงุฏูู โ ุจุฑุฑุณ ูุด โ ุชุงุฏ/ุฑุฏ
   โ
ุณุณุชู โ ูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ูพูู (ุฏุฑ ุตูุฑุช ุชุงุฏ)
```

---

## ๐๏ธ ุณุงุฎุชุงุฑ ุฏุชุงุจุณ

### ุฌุฏูู `tickets`
ุชฺฉุชโูุง ูพุดุชุจุงู ู ุฏุฑุฎูุงุณุชโูุง ุฎุฑุฏ

| ููุฏ | ููุน | ุชูุถุญ |
|------|-----|-------|
| `id` | Integer | ุดูุงุณู ฺฉุชุง |
| `ticket_number` | String(20) | ุดูุงุฑู ุชฺฉุช (ูุซู TK-1001) |
| `candidate_id` | Integer | ุดูุงุณู ฺฉุงูุฏุฏ |
| `ticket_type` | String(50) | ููุน: `purchase` ุง `support` |
| `subject` | String(200) | ููุถูุน ุชฺฉุช |
| `message` | Text | ูุชู ูพุงู |
| `plan_id` | Integer | ุดูุงุณู ูพูู (ุจุฑุง ุชฺฉุชโูุง ุฎุฑุฏ) |
| `payment_method` | String(50) | ุฑูุด ูพุฑุฏุงุฎุช: `card_to_card` ุง `sheba` |
| `payment_amount` | Integer | ูุจูุบ ูพุฑุฏุงุฎุช |
| `receipt_image` | String(300) | ูุณุฑ ูุงู ูุด |
| `status` | String(50) | ูุถุนุช: `pending`, `approved`, `rejected`, `closed` |
| `admin_response` | Text | ูพุงุณุฎ ุงุฏูู |
| `admin_id` | Integer | ุดูุงุณู ุงุฏูู ูพุงุณุฎโุฏููุฏู |
| `created_at` | DateTime | ุชุงุฑุฎ ุซุจุช |
| `updated_at` | DateTime | ุชุงุฑุฎ ุจุฑูุฒุฑุณุงู |
| `closed_at` | DateTime | ุชุงุฑุฎ ุจุณุชู ุดุฏู |

### ุฌุฏูู `payments`
ุณูุงุจู ูพุฑุฏุงุฎุช ู ูุนุงูโุณุงุฒ ูพูู

| ููุฏ | ููุน | ุชูุถุญ |
|------|-----|-------|
| `id` | Integer | ุดูุงุณู ฺฉุชุง |
| `ticket_id` | Integer | ุดูุงุณู ุชฺฉุช ูุฑุชุจุท |
| `candidate_id` | Integer | ุดูุงุณู ฺฉุงูุฏุฏ |
| `plan_id` | Integer | ุดูุงุณู ูพูู |
| `amount` | Integer | ูุจูุบ |
| `payment_method` | String(50) | ุฑูุด ูพุฑุฏุงุฎุช |
| `receipt_image` | String(300) | ูุด ูพุฑุฏุงุฎุช |
| `status` | String(50) | ูุถุนุช: `pending`, `verified`, `failed` |
| `paid_at` | DateTime | ุชุงุฑุฎ ูพุฑุฏุงุฎุช |
| `verified_at` | DateTime | ุชุงุฑุฎ ุชุงุฏ |
| `plan_activated` | Boolean | ุขุง ูพูู ูุนุงู ุดุฏูุ |
| `activation_date` | DateTime | ุชุงุฑุฎ ูุนุงูโุณุงุฒ |
| `expiry_date` | DateTime | ุชุงุฑุฎ ุงููุถุง |

---

## ๐ ูุฑุขูุฏ ฺฉุงูู

### 1๏ธโฃ ูุฑุญูู ฺฉุงูุฏุฏ

#### ูุณุฑ: `/plans/purchase/<plan_id>`

ฺฉุงูุฏุฏ ูุงุฑุฏ ุตูุญู ุฎุฑุฏ ูพูู ูโุดูุฏ ู:

1. **ุงูุชุฎุงุจ ุฑูุด ูพุฑุฏุงุฎุช**:
   - ฺฉุงุฑุช ุจู ฺฉุงุฑุช
   - ุดูุงุฑู ุดุจุง

2. **ูุดุงูุฏู ุงุทูุงุนุงุช ุจุงูฺฉ**:
   - ุดูุงุฑู ฺฉุงุฑุช: `6037-9971-1234-5678`
   - ุดุจุง: `IR120170000000123456789001`
   - ุฏฺฉูู ฺฉูพ ุจุฑุง ุฑุงุญุช ฺฉุงุฑุจุฑ

3. **ุขูพููุฏ ูุด**:
   - ูุฑูุชโูุง ูุฌุงุฒ: JPG, PNG, PDF
   - ุญุฏุงฺฉุซุฑ 5MB

4. **ุซุจุช ุชฺฉุช**:
   - ุดูุงุฑู ุชฺฉุช ุฎูุฏฺฉุงุฑ: `TK-1001`, `TK-1002`, ...
   - ุฐุฎุฑู ุฏุฑ ุฌุฏูู `tickets` ุจุง status=`pending`
   - ุฐุฎุฑู ุฏุฑ ุฌุฏูู `payments` ุจุง status=`pending`

#### ูุณุฑ: `/my-tickets`

ฺฉุงูุฏุฏ ูโุชูุงูุฏ:
- ูุณุช ุชฺฉุชโูุง ุฎูุฏ ุฑุง ูุดุงูุฏู ฺฉูุฏ
- ูุถุนุช ุฑุง ุจุจูุฏ (ุฏุฑ ุงูุชุธุงุฑ / ุชุงุฏ ุดุฏู / ุฑุฏ ุดุฏู)
- ูุด ุขูพููุฏ ุดุฏู ุฑุง ุจุจูุฏ
- ูพุงุณุฎ ุงุฏูู ุฑุง ุจุฎูุงูุฏ
- Timeline ุฑุง ูุดุงูุฏู ฺฉูุฏ

### 2๏ธโฃ ูุฑุญูู ุงุฏูู

#### ูุณุฑ: `/tickets`

ุงุฏูู ูโุชูุงูุฏ:

1. **ููุชุฑ ฺฉุฑุฏู**:
   - ููู ุชฺฉุชโูุง
   - ุฏุฑ ุงูุชุธุงุฑ (pending)
   - ุชุงุฏ ุดุฏู (approved)
   - ุฑุฏ ุดุฏู (rejected)

2. **ูุดุงูุฏู ุขูุงุฑ**:
   - ุชุนุฏุงุฏ ฺฉู ุชฺฉุชโูุง
   - ุชฺฉุชโูุง ุฏุฑ ุงูุชุธุงุฑ
   - ุชฺฉุชโูุง ุชุงุฏ ุดุฏู
   - ุชฺฉุชโูุง ุฑุฏ ุดุฏู

3. **ุจุฑุฑุณ ูุฑ ุชฺฉุช**:
   - ูุงู ฺฉุงูุฏุฏ
   - ูพูู ููุฑุฏ ูุธุฑ
   - ูุจูุบ ูพุฑุฏุงุฎุช
   - ุฑูุด ูพุฑุฏุงุฎุช
   - **ูุดุงูุฏู ูุด** (ุจุง ฺฉูฺฉ ุจุงุฒ ูโุดูุฏ)

4. **ุงูุฏุงู**:
   - **ุชุงุฏ**: `/tickets/<id>/approve`
   - **ุฑุฏ**: `/tickets/<id>/reject`

#### ูุณุฑ: `/tickets/<ticket_id>/approve` (POST)

ุนููุงุช ุงูุฌุงู ุดุฏู:

1. โ ุจุฑูุฒุฑุณุงู `ticket.status = 'approved'`
2. โ ุซุจุช `admin_response`
3. โ ุซุจุช `admin_id`
4. โ ุซุจุช `updated_at`

5. ๐ฏ **ูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ูพูู**:
   - ุจุฑูุฒุฑุณุงู `payment.status = 'verified'`
   - ุซุจุช `payment.verified_at`
   - ุชูุธู `payment.plan_activated = True`
   - ูุญุงุณุจู `payment.activation_date` (ุงูุงู)
   - ูุญุงุณุจู `payment.expiry_date` (ุงูุงู + duration_days ูพูู)

6. ๐ **ุงุถุงูู ฺฉุฑุฏู ูพูู ุจู ฺฉุงูุฏุฏ**:
   - `candidate.plans.append(ticket.plan)` ุฏุฑ ุฌุฏูู many-to-many

7. ๐ **ุซุจุช ุฏุฑ `plan_purchases`**:
   - ุณุงุฎุช ุฑฺฉูุฑุฏ ุฌุฏุฏ ุจุง `is_active=True`
   - ุซุจุช `start_date` ู `end_date`
   - ุงุฏุฏุงุดุช: "ูุนุงูโุณุงุฒ ุงุฒ ุทุฑู ุชฺฉุช TK-XXXX"

#### ูุณุฑ: `/tickets/<ticket_id>/reject` (POST)

ุนููุงุช ุงูุฌุงู ุดุฏู:

1. โ ุจุฑูุฒุฑุณุงู `ticket.status = 'rejected'`
2. โ ุซุจุช `admin_response`
3. โ ุจุฑูุฒุฑุณุงู `payment.status = 'failed'`

---

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง

```
candidate/
โโโ database/
โ   โโโ models.py              # ูุฏูโูุง Ticket ู Payment
โโโ admin_panel/
โ   โโโ app.py                 # Routes: /tickets, /tickets/<id>/approve, /tickets/<id>/reject
โโโ candidate_panel/
โ   โโโ app.py                 # Routes: /plans/purchase/<id>, /my-tickets
โโโ templates/
โ   โโโ admin/
โ   โ   โโโ tickets.html       # ูพูู ุงุฏูู ุจุฑุง ูุฏุฑุช ุชฺฉุชโูุง
โ   โโโ candidate/
โ       โโโ purchase_plan.html # ุตูุญู ุฎุฑุฏ ูพูู ู ุขูพููุฏ ูุด
โ       โโโ my_tickets.html    # ุตูุญู ูุดุงูุฏู ุชฺฉุชโูุง ฺฉุงูุฏุฏ
โโโ uploads/
    โโโ receipts/              # ูุดโูุง ุขูพููุฏ ุดุฏู
```

---

## ๐จ ุตูุญุงุช

### 1. `purchase_plan.html`

**ูฺฺฏโูุง**:
- ููุงุด ุงุทูุงุนุงุช ูพูู (ูุงูุ ููุชุ ูุฏุช)
- ุฑุงุฏู ุจุงุชู ุจุฑุง ุงูุชุฎุงุจ ุฑูุด ูพุฑุฏุงุฎุช
- ฺฉุงุฑุชโูุง ุงุทูุงุนุงุช ุจุงูฺฉ (ุจุง ุฏฺฉูู ฺฉูพ)
- Drag & Drop ุจุฑุง ุขูพููุฏ ูุด
- ุงุนุชุจุงุฑุณูุฌ ูุฑู (ุฑูุด ูพุฑุฏุงุฎุช + ูุงู)
- ุฏฺฉูู ุงุฑุณุงู (ุบุฑูุนุงู ุชุง ุฒูุงู ูพุฑ ุดุฏู ูุฑู)

**ุชุฌุฑุจู ฺฉุงุฑุจุฑ**:
- โจ ุงููุดูโูุง ุฑูุงู
- ๐ ฺฉูพ ฺฉุฑุฏู ุจุง ฺฉ ฺฉูฺฉ
- ๐ฏ ููุงุด ูุงู ูุงู ุงูุชุฎุงุจ ุดุฏู
- โ Toast ุจุฑุง ุชุงุฏ ฺฉูพ

### 2. `my_tickets.html`

**ูฺฺฏโูุง**:
- ูุณุช ุชฺฉุชโูุง ุจุง Badge ุฑูฺฏ ุจุฑุง ูุถุนุช
- ููุงุด ุงุทูุงุนุงุช ฺฉุงูู ูุฑ ุชฺฉุช
- ูพุดโููุงุด ูุด (ุจุง ฺฉูฺฉ ุจุงุฒ ูโุดูุฏ)
- ูพุงุณุฎ ุงุฏูู ุฏุฑ ฺฉุงุฏุฑ ูุฌุฒุง
- Timeline ุจุฑุง ููุงุด ุชุงุฑุฎฺู
- Empty state ุงฺฏุฑ ุชฺฉุช ูุจุงุดุฏ

**ูุถุนุชโูุง**:
- ๐ก ุฏุฑ ุงูุชุธุงุฑ (pending) - ุฒุฑุฏ
- ๐ข ุชุงุฏ ุดุฏู (approved) - ุณุจุฒ
- ๐ด ุฑุฏ ุดุฏู (rejected) - ูุฑูุฒ
- ๐ต ุจุณุชู ุดุฏู (closed) - ุขุจ

### 3. `tickets.html` (ุงุฏูู)

**ูฺฺฏโูุง**:
- ฺฉุงุฑุชโูุง ุขูุงุฑ ุฏุฑ ุจุงูุง (ฺฉูุ ุฏุฑ ุงูุชุธุงุฑุ ุชุงุฏุ ุฑุฏ)
- ููุชุฑ ุจุง Tabโูุง ุฑูฺฏ
- ููุงุด ุชูุงู ุงุทูุงุนุงุช ุชฺฉุช
- ูพุดโููุงุด ูุด ุจุฒุฑฺฏ
- ุฏฺฉููโูุง ุชุงุฏ/ุฑุฏ ุจุฑุง ุชฺฉุชโูุง pending
- Modal ุจุฑุง ููุดุชู ูพุงุณุฎ

**Modal ุชุงุฏ**:
- Textarea ุจุฑุง ูพุงุณุฎ ุจู ฺฉุงุฑุจุฑ
- ุฏฺฉูู ุชุงุฏ ุณุจุฒ
- ุจุณุชู ุจุง ฺฉูฺฉ ุฎุงุฑุฌ Modal

**Modal ุฑุฏ**:
- Textarea ุจุฑุง ุฏูู ุฑุฏ
- ุฏฺฉูู ุฑุฏ ูุฑูุฒ
- ุจุณุชู ุจุง ฺฉูฺฉ ุฎุงุฑุฌ Modal

---

## ๐ ุงููุช

1. **ุขูพููุฏ ูุงู**:
   - ุงุณุชูุงุฏู ุงุฒ `secure_filename()`
   - ูุญุฏูุฏุช ุญุฌู: 16MB
   - ูุงู ูุงู ฺฉุชุง ุจุง timestamp

2. **ุฏุณุชุฑุณ**:
   - `@login_required` ุจุฑุง ููู routeโูุง
   - ุจุฑุฑุณ `candidate_id` ุง `admin_id` ุฏุฑ session

3. **Validation**:
   - ุจุฑุฑุณ ูุฌูุฏ ูุงู ูุจู ุงุฒ ุฐุฎุฑู
   - ุจุฑุฑุณ ูุฌูุฏ ูพูู ู ุชฺฉุช

---

## ๐ ุฑุงูโุงูุฏุงุฒ

### 1. Migration ุฏุชุงุจุณ

```bash
python scripts/init_db.py
```

ุงู ฺฉุงุฑ ุฌุฏุงูู `tickets` ู `payments` ุฑุง ูโุณุงุฒุฏ.

### 2. ุงุฌุงุฏ ูพูุดู receipts

```bash
mkdir -p uploads/receipts
```

### 3. ุงุฌุฑุง ูพููโูุง

```bash
# ูพูู ุงุฏูู
python admin_panel/app.py

# ูพูู ฺฉุงูุฏุฏ
python candidate_panel/app.py
```

---

## ๐ ุขูุงุฑ ู ฺฏุฒุงุฑุดโฺฏุฑ

### Queryโูุง ููุฏ:

```python
# ุชุนุฏุงุฏ ุชฺฉุชโูุง ุฏุฑ ุงูุชุธุงุฑ
pending_count = Ticket.query.filter_by(status='pending').count()

# ุฏุฑุขูุฏ ฺฉู ุงุฒ ูพููโูุง ุชุงุฏ ุดุฏู
total_revenue = db.session.query(db.func.sum(Payment.amount)).filter_by(status='verified').scalar()

# ุขุฎุฑู ุชฺฉุชโูุง ุซุจุช ุดุฏู
latest_tickets = Ticket.query.order_by(Ticket.created_at.desc()).limit(10).all()

# ุชฺฉุชโูุง ฺฉ ฺฉุงูุฏุฏ
candidate_tickets = Ticket.query.filter_by(candidate_id=candidate_id).all()

# ูพููโูุง ูุนุงู ฺฉ ฺฉุงูุฏุฏ
active_plans = Payment.query.filter_by(
    candidate_id=candidate_id,
    plan_activated=True
).filter(Payment.expiry_date > datetime.utcnow()).all()
```

---

## ๐ฏ ูฺฺฏโูุง ูพุงุฏูโุณุงุฒ ุดุฏู

- โ ูุฏูโูุง Ticket ู Payment
- โ ุตูุญู ุฎุฑุฏ ูพูู ุจุง UI ูุฏุฑู
- โ ุขูพููุฏ ูุด ุจุง Drag & Drop
- โ ุงูุชุฎุงุจ ุฑูุด ูพุฑุฏุงุฎุช (ฺฉุงุฑุช ุจู ฺฉุงุฑุช / ุดุจุง)
- โ ฺฉูพ ุงุทูุงุนุงุช ุจุงูฺฉ ุจุง ฺฉ ฺฉูฺฉ
- โ ุณุงุฎุช ุฎูุฏฺฉุงุฑ ุดูุงุฑู ุชฺฉุช
- โ ูพูู ุงุฏูู ุจุฑุง ูุฏุฑุช ุชฺฉุชโูุง
- โ ุชุงุฏ/ุฑุฏ ุจุง Modal
- โ ูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ูพูู ูพุณ ุงุฒ ุชุงุฏ
- โ ููุงุด ุชฺฉุชโูุง ฺฉุงูุฏุฏ ุจุง Timeline
- โ ุขูุงุฑ ู ููุชุฑ ุจุฑุง ุงุฏูู
- โ ูพุดโููุงุด ูุด ุฏุฑ ูุฑ ุฏู ูพูู

---

## ๐ฎ ูพุดููุงุฏุงุช ุชูุณุนู

### ุขูุฏู ูุฒุฏฺฉ:
- ๐ง ุงูู ููุชูฺฉุดู ูพุณ ุงุฒ ุชุงุฏ/ุฑุฏ
- ๐ฑ SMS ููุชูฺฉุดู
- ๐ฌ ุณุณุชู ฺุช ุฏุฑูู ุชฺฉุช
- ๐ ุขูพููุฏ ฺูุฏ ูุงู
- ๐ ููุชูฺฉุดู Real-time
- ๐ ุฏุงุดุจูุฑุฏ ุขูุงุฑ ุจุฑุง ุงุฏูู

### ุขูุฏู ุฏูุฑ:
- ๐ค ุชุดุฎุต ุฎูุฏฺฉุงุฑ ูุด ุจุง OCR
- ๐ ุงุชุตุงู ุจู API ุจุงูฺฉโูุง (ุดุงูพุฑฺฉ)
- ๐ณ ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ุขููุงู
- ๐งพ ุตุฏูุฑ ูุงฺฉุชูุฑ ุฎูุฏฺฉุงุฑ
- ๐ ฺฏุฒุงุฑุดโูุง ุญุณุงุจุฏุงุฑ

---

## ๐ ุนุจโุงุจ

### ูุดฺฉู: ูุด ุขูพููุฏ ููโุดูุฏ
**ุฑุงูโุญู**:
- ุจุฑุฑุณ ูุฌูุฏ ูพูุดู `uploads/receipts/`
- ุจุฑุฑุณ ุฏุณุชุฑุณ ููุดุชู ุฑู ูพูุดู
- ุจุฑุฑุณ ุญุฌู ูุงู (ุจุงุฏ ฺฉูุชุฑ ุงุฒ 16MB ุจุงุดุฏ)

### ูุดฺฉู: ูพูู ูุนุงู ููโุดูุฏ
**ุฑุงูโุญู**:
- ุจุฑุฑุณ ูุฌูุฏ `plan_id` ุฏุฑ ุชฺฉุช
- ุจุฑุฑุณ ุงูฺฉู ุชฺฉุช ููุน `purchase` ุจุงุดุฏ
- ฺฺฉ ฺฉุฑุฏู ูุงฺฏโูุง ฺฉูุณูู

### ูุดฺฉู: ูุด ุฏุฑ ุตูุญู ููุงุด ุฏุงุฏู ููโุดูุฏ
**ุฑุงูโุญู**:
- ุจุฑุฑุณ ูุณุฑ: `url_for('static', filename='../uploads/receipts/...')`
- ุจุฑุฑุณ ุงูฺฉู `receipt_image` ููุท ูุงู ูุงู ุฑุง ุฐุฎุฑู ฺฉูุฏ ูู ูุณุฑ ฺฉุงูู

---

## ๐ ูพุดุชุจุงู

ุจุฑุง ุณูุงูุงุช ู ูุดฺฉูุงุช:
- ๐ง ุงูู: support@candidate.ir
- ๐ฌ ุชูฺฏุฑุงู: @CandidateSupport
- ๐ฑ ุชููู: 021-12345678

---

**ูุณุฎู**: 1.0.0  
**ุชุงุฑุฎ**: 1403/08/22  
**ููุณูุฏู**: ุชู ุชูุณุนู ุณุณุชู ฺฉุงูุฏุฏ

---

๐ **ุชูุงู! ุณุณุชู ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช!**
