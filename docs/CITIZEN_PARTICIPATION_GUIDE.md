# 🤝 سیستم مشارکت مردمی - راهنمای پیاده‌سازی

## 🎯 هدف
ایجاد پلتفرمی که مردم بتوانند مستقیماً در فرآیند تصمیم‌گیری و برنامه‌ریزی کاندید شرکت کنند.

---

## 🌟 فیچر اصلی: **دیواره ایده‌های مردمی**

### مفهوم:
مردم می‌توانند:
- 💡 ایده پیشنهاد دهند
- 📣 مشکل محله را گزارش کنند
- 🗳️ به پیشنهادات دیگران رای دهند
- 💬 نظر بگذارند
- 📊 پیشرفت را ببینند

---

## 📱 تجربه کاربری در بات

### منوی اصلی:
```
🏠 منوی اصلی
┣━ 👤 درباره من
┣━ 📋 برنامه‌ها
┣━ 💡 مشارکت من  ⭐ NEW
┣━ 🗳️ نظرسنجی‌ها
┗━ 📞 تماس با من
```

### کلیک روی "💡 مشارکت من":
```
💡 مشارکت شما
همشهری عزیز، نظرات و پیشنهادات شما برای من بسیار ارزشمند است.

┏━━━━━━━━━━━━━━━━━━┓
┃ چه کاری می‌خواهید انجام دهید؟
┗━━━━━━━━━━━━━━━━━━┛

🔸 ارسال ایده جدید
🔸 گزارش مشکل محله
🔸 مشاهده ایده‌های دیگران
🔸 پیشنهادات من
🔸 تابلوی رتبه‌بندی
```

---

## 🎨 UI/UX پیشنهادی

### 1. ارسال ایده:
```
💡 ارسال ایده جدید

لطفا عنوان ایده خود را بنویسید:
┗━ منتظر ورودی...

سپس:
┣━ توضیحات کامل
┣━ دسته‌بندی (آموزش، بهداشت، ترافیک، ...)
┣━ محل (ارسال لوکیشن - اختیاری)
┗━ عکس (اختیاری)

✅ ارسال شد!
📊 ایده شما در حال بررسی است.
📍 کد پیگیری: #IDEA-1234
```

### 2. گزارش مشکل:
```
📣 گزارش مشکل محله

مشکل شما چیست؟
┗━ منتظر ورودی...

سپس:
┣━ توضیحات دقیق
┣━ دسته‌بندی (خیابان، پارک، نور، ...)
┣━ محل (ضروری)
┗━ عکس (توصیه می‌شود)

✅ گزارش شما ثبت شد!
📍 کد پیگیری: #REP-5678
🔔 پیگیری را در "پیشنهادات من" ببینید
```

### 3. مشاهده ایده‌های دیگران:
```
🌟 محبوب‌ترین ایده‌ها

┏━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ #1 - 🔥 235 رای
┃ 🚸 احداث پل عابر پیاده مقابل دبستان
┃ 📍 خیابان آزادی
┃ 👤 محمد (2 روز پیش)
┃ 
┃ [👍 رای] [💬 نظرات (12)] [مشاهده]
┗━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ #2 - 🔥 198 رای
┃ 🌳 ایجاد پارک محله‌ای در زمین خالی
┃ 📍 کوچه باغستان
┃ 👤 فاطمه (3 روز پیش)
┃ 
┃ [👍 رای] [💬 نظرات (8)] [مشاهده]
┗━━━━━━━━━━━━━━━━━━━━━━━━━━┛

🔍 جستجو | 📊 همه دسته‌ها | ➕ ایده جدید
```

### 4. جزئیات یک ایده:
```
💡 ایده #IDEA-1234

🚸 احداث پل عابر پیاده مقابل دبستان

📝 توضیحات:
خیابان آزادی ترافیک سنگینی دارد و بچه‌ها
برای رفتن به مدرسه در خطر هستند. پل 
عابر پیاده می‌تواند ایمنی را افزایش دهد.

📍 محل: خیابان آزادی، کوی دانشگاه
📷 [2 عکس]
🏷️ دسته: ایمنی - حمل‌ونقل
⏰ 2 روز پیش

━━━━━━━━━━━━━━━━━━
📊 وضعیت: در حال بررسی
👥 235 رای | 12 نظر
━━━━━━━━━━━━━━━━━━

┏━━━━━━━━━━━━━━━━━━┓
┃ [👍 رای دادم]
┃ [💬 نظر بگذارید]
┃ [📤 اشتراک‌گذاری]
┗━━━━━━━━━━━━━━━━━━┛

💬 آخرین نظرات:
┣━ علی: "عالیه، حتما باید اجرا بشه 👏"
┣━ زهرا: "چقدر خوبه که صدامون شنیده میشه"
┗━ حسین: "چند سال منتظر این بودیم"
```

### 5. تابلوی رتبه‌بندی:
```
🏆 فعال‌ترین همشهریان

┏━━━━━━━━━━━━━━━━━━━━━┓
┃ 🥇 محمد احمدی
┃    ⭐ 1,250 امتیاز
┃    📌 12 ایده | 🗳️ 85 رای
┃    🎖️ شهروند نمونه
┗━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━┓
┃ 🥈 فاطمه رضایی
┃    ⭐ 980 امتیاز
┃    📌 8 ایده | 🗳️ 120 رای
┃    🎖️ گزارشگر فعال
┗━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━┓
┃ 🥉 علی کریمی
┃    ⭐ 750 امتیاز
┃    📌 6 ایده | 🗳️ 65 رای
┃    🎖️ شهروند فعال
┗━━━━━━━━━━━━━━━━━━━━━┛

━━━━━━━━━━━━━━━━━━━━━
📊 رتبه من: #24 (450 امتیاز)
💪 تا رتبه بعدی: 50 امتیاز
```

---

## 🎨 پنل کاندید (صفحه جدید)

### صفحه: **مشارکت مردمی**

```html
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 💡 مشارکت مردمی
┃ مدیریت ایده‌ها و پیشنهادات شهروندان
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

📊 آمار کلی:
┣━ 📥 345 پیشنهاد دریافتی
┣━ ⏳ 78 در انتظار بررسی
┣━ ✅ 189 تایید شده
┣━ ❌ 45 رد شده
┗━ 🚀 33 در حال اجرا

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔍 فیلتر:
[همه] [در انتظار] [تایید شده] [رد شده] [اجرا شده]

🔍 دسته‌بندی:
[همه] [آموزش] [بهداشت] [ترافیک] [امنیت] [...] 

🔽 مرتب‌سازی:
[جدیدترین] [محبوب‌ترین] [بیشترین رای]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

لیست ایده‌ها:

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ #IDEA-1234 | 🔥 235 رای | ⏳ در انتظار
┃ 
┃ 🚸 احداث پل عابر پیاده مقابل دبستان
┃ 📍 خیابان آزادی
┃ 👤 محمد احمدی | 📅 2 روز پیش
┃ 📷 [2 عکس] | 💬 12 نظر
┃
┃ [👁️ مشاهده] [✅ تایید] [❌ رد] [📝 پاسخ]
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

---

## 💾 مدل‌های دیتابیس

### 1. CitizenContribution
```python
class CitizenContribution(db.Model):
    """مشارکت‌های مردمی"""
    id = db.Column(db.Integer, primary_key=True)
    contribution_code = db.Column(db.String(20), unique=True)  # IDEA-1234
    candidate_id = db.Column(db.Integer, db.ForeignKey('candidates.id'))
    user_telegram_id = db.Column(db.BigInteger)
    user_name = db.Column(db.String(100))
    
    # نوع و محتوا
    contribution_type = db.Column(db.String(50))  # idea, report
    title = db.Column(db.String(200))
    description = db.Column(db.Text)
    category = db.Column(db.String(50))  # education, health, traffic
    
    # محل
    location = db.Column(db.String(300))
    latitude = db.Column(db.Float)
    longitude = db.Column(db.Float)
    
    # رسانه
    images = db.Column(db.JSON)  # ["path1.jpg", "path2.jpg"]
    
    # وضعیت
    status = db.Column(db.String(50), default='pending')
    # pending, approved, rejected, in_progress, implemented
    
    priority = db.Column(db.String(20), default='medium')
    # low, medium, high, urgent
    
    # تعاملات
    votes_count = db.Column(db.Integer, default=0)
    comments_count = db.Column(db.Integer, default=0)
    views_count = db.Column(db.Integer, default=0)
    
    # پاسخ
    admin_response = db.Column(db.Text)
    responded_at = db.Column(db.DateTime)
    
    # تاریخ‌ها
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    reviewed_at = db.Column(db.DateTime)
    implemented_at = db.Column(db.DateTime)
    
    # روابط
    votes = db.relationship('ContributionVote', backref='contribution')
    comments = db.relationship('ContributionComment', backref='contribution')
```

### 2. ContributionVote
```python
class ContributionVote(db.Model):
    """رای به پیشنهادات"""
    id = db.Column(db.Integer, primary_key=True)
    contribution_id = db.Column(db.Integer, db.ForeignKey('citizen_contributions.id'))
    user_telegram_id = db.Column(db.BigInteger)
    vote_type = db.Column(db.String(10), default='upvote')  # upvote, downvote
    voted_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    # Unique constraint: یک نفر فقط یکبار رای بدهد
    __table_args__ = (
        db.UniqueConstraint('contribution_id', 'user_telegram_id', name='unique_vote'),
    )
```

### 3. ContributionComment
```python
class ContributionComment(db.Model):
    """نظرات روی پیشنهادات"""
    id = db.Column(db.Integer, primary_key=True)
    contribution_id = db.Column(db.Integer, db.ForeignKey('citizen_contributions.id'))
    user_telegram_id = db.Column(db.BigInteger)
    user_name = db.Column(db.String(100))
    comment_text = db.Column(db.Text)
    parent_comment_id = db.Column(db.Integer)  # برای reply
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
```

### 4. CitizenProfile
```python
class CitizenProfile(db.Model):
    """پروفایل شهروند برای گیمیفیکیشن"""
    telegram_id = db.Column(db.BigInteger, primary_key=True)
    full_name = db.Column(db.String(100))
    phone = db.Column(db.String(20))
    neighborhood = db.Column(db.String(100))
    
    # امتیازات
    total_points = db.Column(db.Integer, default=0)
    level = db.Column(db.Integer, default=1)
    
    # آمار
    contributions_count = db.Column(db.Integer, default=0)
    votes_given = db.Column(db.Integer, default=0)
    comments_count = db.Column(db.Integer, default=0)
    
    # نشان‌ها
    badges = db.Column(db.JSON, default=[])
    # ["first_contribution", "top_10", "active_citizen", "problem_solver"]
    
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    last_active = db.Column(db.DateTime)
```

---

## 🎯 سیستم امتیازدهی

### قوانین:
```python
POINTS_SYSTEM = {
    'submit_idea': 10,           # ارسال ایده
    'submit_report': 10,         # گزارش مشکل
    'vote': 1,                   # هر رای
    'comment': 2,                # هر نظر
    'idea_approved': 50,         # ایده تایید شد
    'idea_implemented': 100,     # ایده اجرا شد
    'daily_active': 5,           # فعالیت روزانه
}

LEVEL_THRESHOLDS = {
    1: 0,
    2: 100,
    3: 300,
    4: 600,
    5: 1000,
}

BADGES = {
    'first_contribution': 'اولین مشارکت',
    'top_10': 'در 10 نفر برتر',
    'active_citizen': 'شهروند فعال',
    'problem_solver': 'حل‌کننده مشکلات',
    'idea_master': 'استاد ایده',
}
```

---

## 🔄 فلوی کامل

### 1. کاربر ایده می‌دهد:
```
کاربر در بات → "ارسال ایده"
     ↓
ورود اطلاعات (عنوان، توضیح، عکس، محل)
     ↓
ذخیره در DB با status='pending'
     ↓
ارسال پیام تایید + کد پیگیری
     ↓
+10 امتیاز به کاربر
```

### 2. مردم رای می‌دهند:
```
کاربر "مشاهده ایده‌ها" → کلیک "رای"
     ↓
ذخیره رای در ContributionVote
     ↓
votes_count++ در CitizenContribution
     ↓
+1 امتیاز به رای‌دهنده
     ↓
نوتیفیکیشن به صاحب ایده
```

### 3. کاندید بررسی می‌کند:
```
کاندید در پنل → "مشارکت مردمی"
     ↓
مشاهده لیست با فیلتر
     ↓
کلیک "مشاهده جزئیات"
     ↓
بررسی + تصمیم (تایید/رد/اجرا)
     ↓
نوشتن پاسخ
     ↓
ذخیره + نوتیفیکیشن به کاربر
     ↓
اگر approved: +50 امتیاز به کاربر
```

---

## 🎨 صفحه جزئیات برای کاندید

```html
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <title>جزئیات پیشنهاد #IDEA-1234</title>
</head>
<body>
    <div class="contribution-detail">
        <!-- Header -->
        <div class="header">
            <h1>🚸 احداث پل عابر پیاده مقابل دبستان</h1>
            <div class="badges">
                <span class="badge pending">⏳ در انتظار بررسی</span>
                <span class="badge priority-high">🔴 اولویت بالا</span>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="stats-row">
            <div class="stat">
                <i class="fas fa-thumbs-up"></i>
                <span>235 رای</span>
            </div>
            <div class="stat">
                <i class="fas fa-comments"></i>
                <span>12 نظر</span>
            </div>
            <div class="stat">
                <i class="fas fa-eye"></i>
                <span>450 بازدید</span>
            </div>
        </div>
        
        <!-- User Info -->
        <div class="user-info">
            <img src="avatar.jpg" alt="محمد">
            <div>
                <strong>محمد احمدی</strong>
                <span>شهروند فعال 🎖️</span>
            </div>
            <span class="date">2 روز پیش</span>
        </div>
        
        <!-- Description -->
        <div class="description">
            <h3>📝 توضیحات:</h3>
            <p>خیابان آزادی ترافیک سنگینی دارد...</p>
        </div>
        
        <!-- Details -->
        <div class="details">
            <div class="detail-item">
                <strong>📍 محل:</strong>
                <span>خیابان آزادی، کوی دانشگاه</span>
                <button onclick="showMap()">🗺️ نمایش روی نقشه</button>
            </div>
            <div class="detail-item">
                <strong>🏷️ دسته‌بندی:</strong>
                <span>ایمنی - حمل‌ونقل</span>
            </div>
        </div>
        
        <!-- Images -->
        <div class="images-gallery">
            <h3>📷 تصاویر:</h3>
            <div class="gallery">
                <img src="img1.jpg" alt="عکس 1">
                <img src="img2.jpg" alt="عکس 2">
            </div>
        </div>
        
        <!-- Comments -->
        <div class="comments-section">
            <h3>💬 نظرات مردم (12):</h3>
            <div class="comment">
                <strong>علی:</strong>
                <p>عالیه، حتما باید اجرا بشه 👏</p>
            </div>
            <!-- ... -->
        </div>
        
        <!-- Admin Actions -->
        <div class="admin-actions">
            <h3>🎯 اقدام:</h3>
            
            <div class="action-buttons">
                <button class="btn-approve" onclick="approveContribution()">
                    ✅ تایید و قبول
                </button>
                <button class="btn-progress" onclick="markInProgress()">
                    🔄 در حال اجرا
                </button>
                <button class="btn-reject" onclick="rejectContribution()">
                    ❌ رد کردن
                </button>
            </div>
            
            <div class="response-form">
                <label>📝 پاسخ به شهروند:</label>
                <textarea placeholder="پیام شما به شهروند..."></textarea>
                <button class="btn-send">ارسال پاسخ</button>
            </div>
        </div>
    </div>
</body>
</html>
```

---

## 📊 گزارش‌های پیشنهادی

### 1. گزارش هفتگی:
```
📊 گزارش مشارکت مردمی - هفته 42

📥 پیشنهادات دریافتی: 45
✅ تایید شده: 12
🔄 در حال اجرا: 8
❌ رد شده: 3
⏳ در انتظار: 22

🔥 محبوب‌ترین دسته: ترافیک (15 پیشنهاد)
👥 فعال‌ترین شهروند: محمد احمدی (5 پیشنهاد)
📈 رشد مشارکت: +28% نسبت به هفته قبل
```

### 2. Dashboard:
```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ نمودار روند مشارکت (30 روز اخیر)
┃     ▁▂▃▅▆█▇▆▅▄▃▂▁
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

دسته‌بندی پیشنهادات:
🚦 ترافیک:        ████████░░ 45%
📚 آموزش:         ██████░░░░ 25%
🏥 بهداشت:        ████░░░░░░ 18%
🌳 محیط زیست:     ██░░░░░░░░ 8%
💡 سایر:           █░░░░░░░░░ 4%
```

---

## 🚀 مراحل پیاده‌سازی

### مرحله 1 (هفته 1):
- [ ] ایجاد مدل‌های دیتابیس
- [ ] API های CRUD برای contributions
- [ ] صفحه لیست در پنل کاندید

### مرحله 2 (هفته 2):
- [ ] دکمه "مشارکت من" در بات
- [ ] فرم ارسال ایده
- [ ] فرم گزارش مشکل
- [ ] ذخیره در دیتابیس

### مرحله 3 (هفته 3):
- [ ] صفحه مشاهده ایده‌ها در بات
- [ ] سیستم رای‌گیری
- [ ] سیستم نظرات
- [ ] نوتیفیکیشن‌ها

### مرحله 4 (هفته 4):
- [ ] صفحه جزئیات در پنل کاندید
- [ ] تایید/رد/پاسخ
- [ ] سیستم امتیازدهی
- [ ] تابلوی رتبه‌بندی

---

## 💎 ارزش افزوده برای کاندید

✅ **درگیر کردن مردم** - احساس مالکیت  
✅ **جمع‌آوری ایده‌های واقعی** - از دل محله  
✅ **شناسایی مشکلات** - قبل از سوال مردم  
✅ **افزایش مشارکت** - مردم بیشتر vote می‌کنند  
✅ **داده‌های ارزشمند** - می‌دانید چه می‌خواهند  
✅ **تصویر مثبت** - کاندیدی که گوش می‌دهد  

---

**نتیجه**: این فیچر می‌تواند game-changer باشد! 🚀
